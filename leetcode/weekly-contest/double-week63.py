#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Time    : 2021/10/18 下午7:20
# @Author  : pengyuan.li
# @Site    : 
# @File    : double-week63.py
# @Software: PyCharm


"""
2040. 两个有序数组的第 K 小乘积
给你两个 从小到大排好序 且下标从 0 开始的整数数组 nums1 和 nums2 以及一个整数 k ，请你返回第 k （从 1 开始编号）小的 nums1[i] * nums2[j] 的乘积，
其中 0 <= i < nums1.length 且 0 <= j < nums2.length 。

"""
from typing import List


def kthSmallestProduct(nums1: List[int], nums2: List[int], k: int) -> int:
    """
    若都是正数，即递增序列，可利用最小堆计算（比如，加法肯定可以）
    nums1=neg1+pos1，（负数+非负数）
    :param nums1:
    :param nums2:
    :param k:
    :return:
    """
    neg1, pos1 = [], []
    neg2, pos2 = [], []
    for x in nums1:
        if x >= 0:
            pos1.append(x)
        else:
            neg1.append(-x)
    for x in nums2:
        if x >= 0:
            pos2.append(x)
        else:
            neg2.append(-x)
    neg1.reverse()
    neg2.reverse()

    def getCnts(A, B, x):
        """
        A[i]*B[j]<=x的个数
        :param A:
        :param B:
        :param x:
        :return:
        """
        cnts = 0
        for i in range(len(A)):
            j = len(B)
            while j >= 1 and B[j - 1] * A[i] >= x:
                j -= 1
            cnts += j
        return cnts

    def getCnts2(A, B, x):
        cnts = 0
        for i in range(len(A)):
            j = len(B)
            while j >= 1 and B[j - 1] * A[i] > x:
                j -= 1
            cnts += (len(B) - j)
        return cnts

    left = -10000000000
    right = 10000000000
    while left < right - 1:
        mid = (left + right) >> 1
        cnt = 0
        cnt += getCnts(pos1, pos2, mid)
        cnt += getCnts(neg1, neg2, mid)
        cnt += getCnts2(neg1, pos2, -mid)
        cnt += getCnts2(neg2, pos1, -mid)
        if cnt >= k:
            right = mid
        else:
            left = mid
    return left


if __name__ == "__main__":
    nums1 = [-2, -1, 0, 1, 2]
    nums2 = [-3, -1, 2, 4, 5]
    k = 3
    print(kthSmallestProduct(nums1, nums2, k))

    nums1 = [-496, -494, -493, -493, -491, -491, -490, -490, -487, -486, -485, -484, -481, -479, -478, -475, -470, -465,
             -465,
             -462, -460, -460, -459, -457, -456, -455, -454, -453, -451, -450, -450, -449, -449, -449, -444, -444, -441,
             -440,
             -438, -437, -436, -436, -436, -434, -432, -431, -428, -427, -425, -425, -424, -423, -422, -422, -419, -419,
             -419,
             -419, -418, -416, -414, -411, -410, -409, -409, -407, -406, -400, -398, -397, -396, -394, -390, -389, -388,
             -387,
             -387, -383, -381, -380, -380, -379, -377, -377, -377, -376, -375, -375, -374, -370, -370, -366, -366, -365,
             -363,
             -362, -362, -361, -360, -360, -359, -359, -358, -356, -354, -352, -352, -350, -349, -347, -342, -338, -337,
             -336,
             -334, -333, -330, -330, -330, -324, -323, -321, -321, -320, -317, -316, -316, -315, -312, -310, -308, -308,
             -307,
             -303, -302, -300, -293, -293, -291, -289, -289, -288, -288, -287, -285, -284, -282, -279, -278, -275, -271,
             -269,
             -267, -261, -258, -257, -256, -255, -254, -252, -248, -248, -248, -245, -245, -244, -244, -244, -244, -241,
             -239,
             -237, -235, -234, -234, -233, -233, -233, -231, -227, -223, -222, -221, -220, -212, -211, -207, -207, -206,
             -204,
             -204, -202, -200, -199, -198, -195, -192, -191, -191, -191, -190, -189, -189, -188, -187, -187, -185, -181,
             -180,
             -178, -178, -169, -165, -164, -163, -163, -162, -161, -160, -157, -156, -156, -155, -153, -151, -148, -146,
             -146,
             -144, -144, -142, -142, -141, -139, -137, -136, -134, -130, -129, -122, -121, -121, -120, -119, -119, -118,
             -116,
             -116, -112, -112, -112, -110, -106, -104, -103, -102, -101, -100, -97, -97, -97, -96, -95, -95, -93, -91,
             -91, -89,
             -87, -87, -86, -86, -85, -85, -82, -82, -81, -80, -80, -79, -76, -75, -72, -72, -70, -69, -68, -67, -67,
             -67, -65,
             -62, -60, -60, -59, -47, -46, -42, -40, -39, -38, -35, -35, -34, -34, -33, -31, -30, -28, -28, -27, -27,
             -22, -22,
             -20, -16, -14, -13, -12, -10, -8, -7, -3, -3, -1, -1, -1, 0, 3, 7, 7, 7, 9, 9, 10, 11, 11, 12, 13, 14, 17,
             18, 19,
             20, 21, 22, 22, 22, 23, 23, 24, 26, 29, 29, 30, 31, 34, 35, 35, 36, 36, 37, 38, 38, 39, 40, 43, 43, 45, 54,
             55, 59,
             62, 62, 62, 65, 65, 67, 68, 71, 72, 75, 75, 77, 78, 81, 84, 86, 91, 95, 97, 98, 98, 98, 104, 105, 107, 108,
             110,
             110, 115, 115, 116, 118, 119, 119, 120, 120, 123, 125, 126, 127, 131, 132, 136, 140, 140, 141, 143, 145,
             146, 149,
             150, 150, 150, 151, 151, 152, 152, 154, 154, 154, 155, 155, 156, 160, 162, 171, 171, 171, 174, 176, 176,
             178, 179,
             179, 181, 182, 185, 185, 185, 186, 186, 187, 188, 192, 194, 196, 198, 200, 202, 205, 206, 216, 216, 216,
             217, 220,
             220, 222, 222, 227, 227, 228, 228, 230, 231, 232, 233, 236, 236, 237, 237, 238, 240, 241, 242, 243, 244,
             246, 246,
             247, 247, 247, 248, 248, 251, 252, 253, 253, 258, 259, 260, 264, 264, 265, 265, 268, 268, 275, 276, 277,
             277, 278,
             279, 281, 283, 284, 286, 286, 288, 290, 292, 294, 297, 298, 300, 301, 301, 304, 306, 306, 306, 307, 309,
             309, 311,
             312, 313, 314, 315, 317, 320, 320, 321, 324, 325, 326, 328, 329, 334, 335, 335, 337, 337, 339, 339, 341,
             341, 342,
             343, 345, 346, 347, 348, 349, 349, 352, 355, 355, 356, 357, 358, 360, 360, 363, 363, 366, 367, 367, 367,
             367, 370,
             371, 376, 378, 378, 379, 379, 381, 383, 383, 384, 387, 394, 394, 396, 397, 398, 398, 401, 403, 405, 406,
             406, 409,
             411, 411, 411, 412, 413, 414, 414, 414, 414, 415, 417, 418, 419, 420, 420, 421, 423, 423, 426, 427, 429,
             431, 432,
             432, 433, 434, 435, 437, 438, 438, 438, 440, 441, 444, 447, 452, 456, 457, 457, 457, 457, 460, 461, 461,
             464, 465,
             467, 467, 467, 468, 471, 471, 474, 482, 484, 485, 489, 491, 491, 491, 492, 494, 494, 495, 495, 495, 497,
             498, 499,
             500]
    nums2 = [-498, -497, -485, -483, -481, -480, -476, -474, -472, -471, -468, -466, -465, -464, -461, -461, -457, -449,
             -444,
             -437, -434, -431, -431, -430, -429, -426, -424, -421, -416, -405, -402, -401, -400, -399, -392, -390, -385,
             -384,
             -380, -378, -376, -376, -373, -367, -366, -360, -347, -346, -343, -342, -340, -340, -339, -338, -336, -333,
             -332,
             -331, -324, -319, -319, -316, -310, -301, -297, -294, -291, -280, -276, -267, -266, -263, -262, -262, -248,
             -236,
             -235, -234, -234, -225, -222, -220, -217, -214, -210, -210, -209, -209, -206, -204, -203, -202, -201, -200,
             -200,
             -195, -193, -189, -186, -185, -183, -182, -182, -181, -181, -176, -176, -174, -172, -167, -165, -162, -158,
             -155,
             -150, -139, -138, -136, -123, -123, -122, -121, -119, -119, -119, -113, -108, -108, -107, -103, -99, -96,
             -88, -88,
             -88, -85, -83, -82, -80, -72, -70, -68, -67, -53, -51, -50, -44, -44, -43, -42, -37, -33, -30, -26, -25,
             -22, -19,
             -18, -15, -13, -11, -5, -5, 0, 3, 4, 8, 9, 11, 13, 15, 16, 17, 18, 21, 22, 22, 24, 24, 25, 27, 28, 29, 35,
             35, 36,
             41, 42, 43, 45, 45, 46, 50, 55, 58, 58, 60, 62, 70, 79, 83, 83, 84, 84, 93, 94, 100, 102, 106, 107, 110,
             112, 115,
             115, 117, 117, 117, 118, 118, 126, 132, 132, 133, 138, 138, 138, 141, 146, 147, 149, 151, 154, 157, 167,
             175, 177,
             178, 179, 180, 180, 180, 183, 183, 185, 188, 194, 195, 195, 197, 197, 200, 200, 205, 207, 212, 212, 216,
             220, 225,
             227, 228, 229, 229, 232, 234, 243, 245, 248, 248, 252, 256, 258, 267, 267, 269, 272, 272, 273, 274, 275,
             284, 287,
             289, 289, 293, 298, 298, 303, 304, 310, 312, 316, 316, 317, 326, 331, 335, 339, 340, 342, 345, 345, 347,
             351, 356,
             356, 361, 361, 375, 375, 378, 378, 380, 380, 382, 389, 396, 405, 409, 412, 417, 417, 419, 419, 426, 427,
             434, 441,
             442, 443, 447, 448, 449, 451, 452, 456, 460, 464, 464, 465, 467, 473, 474, 475, 476, 478, 488, 488, 491,
             500, 500]
    k = 120230
    print(kthSmallestProduct(nums1, nums2, k))
